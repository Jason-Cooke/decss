/*jshint loopfunc: true */(function(e,t,n,r,i){"use strict";function a(t){t||(t=e.location.hash);return t.replace(/^#/,"")}function f(e,t){try{return Array.prototype.slice.call(e.querySelectorAll(t),0)}catch(n){return[]}}function l(e,t,n){e=String(e);while(e.length<n)e=[t,e].join("");return e}function c(){this.__html=t.getElementsByTagName("html")[0];this.__body=t.body||t.documentElement;this.__progress=t.createElement("progress");this.__timer=t.createElement("time");this.__selector=t.createElement("select");this.__started=null;this.__socket=null;this.__socketReady=!1;this.__socketQueue=[];this.deck=t.getElementById("deck");this.slides=f(this.deck,"section");this.id=this.deck.getAttribute("data-id");this.currentSlide=this.slides[0];this.currentPosition=0;this.touchDuration=Math.max(this.deck.getAttribute("data-touch-duration")?parseFloat(this.deck.getAttribute("data-touch-duration")):0,500);this.touchDistance=Math.max(this.deck.getAttribute("data-touch-distance")?parseFloat(this.deck.getAttribute("data-touch-distance")):0,150);this.fullscreen=!1;this.debug=this.deck.getAttribute("data-debug")?!!i.parse(this.deck.getAttribute("data-debug")):!1}var s={queryselectorall:t.querySelectorAll,classlist:(t.body||t.documentElement).classList,addeventlistener:e.addEventListener,forEach:Array.prototype.forEach,indexOf:Array.prototype.indexOf,json:i&&i.parse&&i.stringify},o=!0;for(var u in s)if(typeof s[u]=="undefined"){(t.body||t.documentElement).className+=[" ",u,"-not-supported"].join("");o=!1}if(!o){(t.body||t.documentElement).className+=" not-supported";return}c.prototype.__debug=function(){this.debug&&n.debug&&n.debug.apply(n,arguments)};c.prototype.init=function(){var n=this;n.__progress.setAttribute("max",n.slides.length);n.__setProgress(1);n.__body.appendChild(n.__progress);n.__timer.setAttribute("id","timer");n.__timer.innerHTML="0:00";n.__body.appendChild(n.__timer);n.slides.forEach(function(e,t){e.getAttribute("id")||e.setAttribute("id",["slide",t+1].join("-"));var r="0";f(e,"[data-step]").forEach(function(e){r=r<e.getAttribute("data-step")?e.getAttribute("data-step"):r});e.steps=parseFloat(r);e.setAttribute("data-current-step",0);e.setAttribute("data-steps",e.steps.toFixed("0"));e.currentStep=0;e.setAttribute("data-slide",t+1);e.setAttribute("data-total",n.slides.length)});n.__selector.setAttribute("id","selector");var r=t.createElement("option"),i=n.slides.length;while(i--){var s=r.cloneNode();s.setAttribute("value",i);s.innerHTML="Slide "+l(i+1,"0",String(n.slides.length).length)+": "+n.slides[i].getAttribute("id");n.__selector.insertBefore(s,n.__selector.firstChild)}n.__body.appendChild(n.__selector);n.__selector.addEventListener("change",function(e){n.changeToSlide(parseFloat(n.__selector.value))},!1);e.addEventListener("load",function(){f(n.deck,"figure").forEach(function(e){e.maxHeight=0;f(e,"img").forEach(function(t){t.displayHeight=t.getAttribute("height")?parseFloat(t.getAttribute("height")):t.height;e.maxHeight=t.displayHeight>e.maxHeight?t.displayHeight:e.maxHeight});e.style.maxHeight=e.maxHeight+"px"})},!1);n.__socketSetup();if(!e.location.hash){e.location.hash=n.slides.length?n.slides[0].getAttribute("id"):"";n.changeToSlide(n.slides[0],0,"init")}else{var o=!1;n.slides.forEach(function(e){if(e.getAttribute("id")===a()){o=!0;n.changeToSlide(e,0,"init");return}});o||n.home()}e.addEventListener("load",function(){n.__html.classList.add("ready")});t.addEventListener("webkitfullscreenchange",function(e){n.fullscreen=!!t.webkitFullscreenElement},!1);t.addEventListener("mozfullscreenchange",function(e){n.fullscreen=!!t.mozFullScreenElement},!1);t.addEventListener("msfullscreenchange",function(e){n.fullscreen=!!t.msFullscreenElement},!1);t.addEventListener("fullscreenchange",function(e){n.fullscreen=!!t.fullscreenElement},!1);t.addEventListener("keydown",function(e){switch(e.keyCode){case 33:case 37:n.previous("keyboard");break;case 34:case 39:n.next("keyboard");break;case 27:e.ctrlKey&&n.__html.classList.toggle("presenter");break;case 35:n.end("keyboard");break;case 36:n.home("keyboard");break;case 70:n.goFullscreen();break;default:}},!1);if("ontouchstart"in n.__body){var u={x:0,y:0,time:0};n.__body.addEventListener("touchstart",function(e){var t=e.changedTouches[0];u.x=t.pageX;u.y=t.pageY;u.time=(new Date).getTime();e.preventDefault()},!1);n.__body.addEventListener("touchmove",function(e){e.preventDefault()},!1);n.__body.addEventListener("touchend",function(e){var t=e.changedTouches[0],r=(new Date).getTime(),i={x:u.x-t.pageX,y:u.y-t.pageY,time:r-u.time};if(i.time<=n.touchDuration&&Math.abs(i.x)>=Math.abs(i.y))if(i.x>=n.touchDistance){n.next("touch");n.__started||n.__updateTimer()}else if(i.x<=0-n.touchDistance){n.previous("touch");n.__started||n.__updateTimer()}},!1)}n.__emitEvent("decssinit")};c.prototype.goFullscreen=function(){this.__html.webkitRequestFullscreen?this.goFullscreen=function(){this.__html.webkitRequestFullscreen()}:this.__html.msRequestFullscreen?this.goFullscreen=function(){this.__html.msRequestFullscreen()}:this.__html.mozRequestFullscreen?this.goFullscreen=function(){this.__html.mozRequestFullscreen()}:this.__html.requestFullscreen&&(this.goFullscreen=function(){this.deck.requestFullscreen()});this.goFullscreen()};c.prototype.__socketSend=function(e){if(e){e.id=this.id;this.__socketQueue.push(e)}if(this.__socketReady){e=this.__socketQueue.shift();while(e){this.__socket.send(i.stringify(e));this.__debug("sending message",i.stringify(e));e=this.__socketQueue.shift()}}else{var t=this;setTimeout(function(){t.__socketSend()},100)}};c.prototype.__socketSetup=function(){r&&this.deck.getAttribute("data-sync-server")?this.__socketSetup=function(){var e=this;e.__socket=new r(["ws://",e.deck.getAttribute("data-sync-server")].join(""));e.__socket.onopen=function(){e.__socketReady=!0};e.__socket.onerror=function(t){e.__debug("socket error",t)};e.__socket.onmessage=function(t){e.__debug("received message",t);t=i.parse(t.data);t.id===e.id&&e.changeToSlide(a(t.hash),t.step,"socket")};e.__socket.onclose=function(){e.__socketReady=!1;setTimeout(e.__socketSetup,1e3)}}:this.__socketSetup=function(){this.__socket={send:function(){},status:"UNSUPPORTED"}};this.__socketSetup()};c.prototype.__updateTimer=function(){var e=this,t=new Date,n;e.__started||(e.__started=t);n=t-e.__started;e.__timer.innerHTML=[Math.floor(n/6e4),l(Math.floor(n/1e3)%60,"0",2)].join(":");setTimeout(function(){e.__updateTimer()},1e3)};c.prototype.__setProgress=function(e){this.__progress.setAttribute("value",e);this.__selector.value=e-1};c.prototype.__emitEvent=function(e,t){t||(t={});t.deck=this;var n=new CustomEvent(e,{detail:t,bubbles:!0});this.__debug("emitting "+e+" event",n);this.deck.dispatchEvent(n)};t.addEventListener("decsschange",function(e){if(e.detail&&e.detail.deck&&e.detail.slide&&e.detail.sender&&e.detail.sender!=="socket"){var t=e.detail.deck;t.__socketSend({hash:e.detail.slide.getAttribute("id"),step:e.detail.step})}},!1);c.prototype.changeToSlide=function(t,n,r){var i=this;!i.__started&&(r==="keyboard"||r==="touch")&&i.__updateTimer();typeof t=="string"?t=f(i.deck,["#",a(t)].join("")).pop(0):typeof t=="number"&&i.slides.length&&t>=0&&t<i.slides.length&&(t=i.slides[t]);if(t&&i.currentSlide!==t){e.location.href=["#",t.getAttribute("id")].join("");i.__body.setAttribute("data-current-slide",a());i.__body.scrollTop=0;i.__setProgress(i.slides.indexOf(t)+1);f(t,"audio:not([data-step]):not([controls]),video:not([data-step]):not([controls])").forEach(function(e){if(e.play){e.played.length&&(e.src=e.currentSrc);e.play()}});var s=i.currentPosition,o=i.currentSlide;i.currentSlide=t;i.currentPosition=i.slides.indexOf(t);if(Math.abs(i.currentPosition-s)>1)if(i.currentPosition-s>0)while(s<i.currentPosition){o=i.slides[s];f(o,"[data-step]:not(.active)").forEach(function(e){e.classList.add("active")});o.currentStep=o.steps;s+=1}else while(i.currentPosition<s){o=i.slides[s];f(o,"[data-step].active").forEach(function(e){e.classList.remove("active")});o.currentStep=0;s-=1}i.__setProgress(i.currentPosition+1)}if(t&&t===i.currentSlide&&typeof n!="undefined"&&n!==t.currentStep)if(n<t.currentStep)while(t.currentStep>n){f(i.currentSlide,'[data-step="'+i.currentSlide.currentStep+'"]').forEach(function(e){e.classList.remove("active")});i.currentSlide.currentStep-=1;i.currentSlide.setAttribute("data-current-step",i.currentSlide.currentStep)}else if(n>t.currentStep)while(t.currentStep<n){i.currentSlide.currentStep+=1;i.currentSlide.setAttribute("data-current-step",i.currentSlide.currentStep);f(i.currentSlide,'[data-step="'+i.currentSlide.currentStep+'"]').forEach(function(e){e.classList.add("active");if(e.play){e.played.length&&(e.src=e.currentSrc);e.play()}})}i.currentSlide.setAttribute("data-current-step",i.currentSlide.currentStep);i.__emitEvent("decsschange",{slide:i.currentSlide,step:i.currentSlide.currentStep,sender:r});i.currentPosition===i.slides.length-1&&i.currentSlide.currentStep===i.currentSlide.steps&&i.__emitEvent("decssend",{sender:r})};c.prototype.previous=function(e){this.currentSlide.currentStep>=1?this.changeToSlide(this.currentSlide,this.currentSlide.currentStep-1,e):this.currentPosition-1>=0&&this.changeToSlide(this.currentPosition-1,this.slides[this.currentPosition-1].currentStep,e)};c.prototype.next=function(e){this.currentSlide.currentStep<this.currentSlide.steps?this.changeToSlide(this.currentSlide,this.currentSlide.currentStep+1,e):this.currentPosition+1<this.slides.length&&this.changeToSlide(this.currentPosition+1,this.slides[this.currentPosition+1].currentStep,e)};c.prototype.home=function(e){this.changeToSlide(this.slides[0],0,e)};c.prototype.end=function(e){this.changeToSlide(this.slides[this.slides.length-1],0,e)};var h=new c;e.Decss=h;h.init()})(window,document,window.console,window.WebSocket,window.JSON);