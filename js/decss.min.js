/*jshint loopfunc: true */(function(e,t,n,r,i){"use strict";function a(t){t||(t=e.location.hash);return t.replace(/^#/,"")}function f(e,t){try{return Array.prototype.slice.call(e.querySelectorAll(t),0)}catch(n){return[]}}function l(e,t,n){e=String(e);while(e.length<n)e=[t,e].join("");return e}function c(e){return e.reduce(function(e,t){e.indexOf(t)<0&&e.push(t);return e},[])}function h(e,t){var n=[];while(e<=t)n.push(e++);return n}function p(e){return e.reduce(function(e,t){return e+t},0)}function d(e){return parseFloat(e.getAttribute("data-step"))*1}function g(){this.__html=t.getElementsByTagName("html")[0];this.__body=t.body||t.documentElement;this.__progress=t.createElement("progress");this.__timer=t.createElement("time");this.__selector=t.createElement("select");this.__started=null;this.__socket=null;this.__socketReady=!1;this.__socketQueue=[];this.deck=t.getElementById("deck");this.slides=f(this.deck,"section");this.id=this.deck.getAttribute("data-id");this.currentSlide=this.slides[0];this.currentPosition=0;this.touchDuration=Math.max(this.deck.getAttribute("data-touch-duration")?parseFloat(this.deck.getAttribute("data-touch-duration")):0,500);this.touchDistance=Math.max(this.deck.getAttribute("data-touch-distance")?parseFloat(this.deck.getAttribute("data-touch-distance")):0,150);this.fullscreen=!1;this.debug=this.deck.getAttribute("data-debug")?!!i.parse(this.deck.getAttribute("data-debug")):!1;this.inControl=!1;this.allowControl=null}function y(){m=new g;e.Decss=m;m.init()}var s={queryselectorall:t.querySelectorAll,classlist:(t.body||t.documentElement).classList,addeventlistener:e.addEventListener,forEach:Array.prototype.forEach,indexOf:Array.prototype.indexOf,map:Array.prototype.map,reduce:Array.prototype.reduce,json:i&&i.parse&&i.stringify},o=!0;for(var u in s)if(typeof s[u]=="undefined"){(t.body||t.documentElement).className+=[" ",u,"-not-supported"].join("");o=!1}if(!o){(t.body||t.documentElement).className+=" not-supported";return}var v=!1,m;g.prototype.__debug=function(){this.debug&&n.debug&&n.debug.apply(n,arguments)};g.prototype.init=function(){m.__progress.setAttribute("max",m.slides.length);m.__setProgress(1);m.__body.appendChild(m.__progress);m.__timer.setAttribute("id","timer");m.__timer.innerHTML="0:00";m.__body.appendChild(m.__timer);m.slides.forEach(function(e,t){e.getAttribute("id")||e.setAttribute("id",["slide",t+1].join("-"));var n=f(e,'[data-step]:not([data-step="0"])'),r=c(n.map(d)),s=h(1,r.length),o=Math.max.apply(null,s);(r.length!==s.length||p(r)!==p(s))&&n.forEach(function(e){e.setAttribute("data-step",s[r.indexOf(i.parse(e.getAttribute("data-step")))])});e.steps=isFinite(o)?o:0;e.setAttribute("data-current-step",0);e.setAttribute("data-steps",e.steps);e.currentStep=0;e.setAttribute("data-slide",t+1);e.setAttribute("data-total",m.slides.length)});m.__selector.setAttribute("id","selector");var n=t.createElement("option"),r=m.slides.length;while(r--){var s=n.cloneNode();s.setAttribute("value",r);s.innerHTML="Slide "+l(r+1,"0",String(m.slides.length).length)+": "+m.slides[r].getAttribute("id");m.__selector.insertBefore(s,m.__selector.firstChild)}m.__body.appendChild(m.__selector);m.__selector.addEventListener("change",function(e){m.changeToSlide(parseFloat(m.__selector.value))},!1);e.addEventListener("load",function(){f(m.deck,"figure").forEach(function(e){e.maxHeight=0;f(e,"img").forEach(function(t){t.displayHeight=t.getAttribute("height")?parseFloat(t.getAttribute("height")):t.height;e.maxHeight=t.displayHeight>e.maxHeight?t.displayHeight:e.maxHeight});e.style.maxHeight=e.maxHeight+"px"})},!1);m.__socketSetup();if(!e.location.hash){e.location.hash=m.slides.length?m.slides[0].getAttribute("id"):"";m.changeToSlide(m.slides[0],0,"init")}else{var o=!1;m.slides.forEach(function(e){if(e.getAttribute("id")===a()){o=!0;m.changeToSlide(e,0,"init");return}});o||m.home()}e.addEventListener("load",function(){m.__html.classList.add("ready")});t.addEventListener("webkitfullscreenchange",function(e){m.fullscreen=!!t.webkitFullscreenElement},!1);t.addEventListener("mozfullscreenchange",function(e){m.fullscreen=!!t.mozFullScreenElement},!1);t.addEventListener("msfullscreenchange",function(e){m.fullscreen=!!t.msFullscreenElement},!1);t.addEventListener("fullscreenchange",function(e){m.fullscreen=!!t.fullscreenElement},!1);t.addEventListener("keydown",function(e){switch(e.keyCode){case 33:case 37:m.previous("keyboard");break;case 34:case 39:m.next("keyboard");break;case 27:e.ctrlKey&&m.__html.classList.toggle("presenter");break;case 35:m.end("keyboard");break;case 36:m.home("keyboard");break;case 70:m.goFullscreen();break;default:}},!1);if("ontouchstart"in m.__body){var u={x:0,y:0,time:0};m.__body.addEventListener("touchstart",function(e){var t=e.changedTouches[0];u.x=t.pageX;u.y=t.pageY;u.time=(new Date).getTime();e.preventDefault()},!1);m.__body.addEventListener("touchmove",function(e){e.preventDefault()},!1);m.__body.addEventListener("touchend",function(e){var t=e.changedTouches[0],n=(new Date).getTime(),r={x:u.x-t.pageX,y:u.y-t.pageY,time:n-u.time};if(r.time<=m.touchDuration&&Math.abs(r.x)>=Math.abs(r.y))if(r.x>=m.touchDistance){m.next("touch");m.__started||m.__updateTimer()}else if(r.x<=0-m.touchDistance){m.previous("touch");m.__started||m.__updateTimer()}},!1)}m.__emitEvent("decssinit")};g.prototype.goFullscreen=function(){this.__html.webkitRequestFullscreen?this.goFullscreen=function(){this.__html.webkitRequestFullscreen()}:this.__html.msRequestFullscreen?this.goFullscreen=function(){this.__html.msRequestFullscreen()}:this.__html.mozRequestFullscreen?this.goFullscreen=function(){this.__html.mozRequestFullscreen()}:this.__html.requestFullscreen&&(this.goFullscreen=function(){this.deck.requestFullscreen()});this.goFullscreen()};g.prototype.__socketSend=function(e){if(e){e.id=this.id;e.type=e.type?e.type:"sync";this.__socketQueue.push(e)}if(this.__socketReady){e=this.__socketQueue.shift();while(e){this.__socket.send(i.stringify(e));this.__debug("sending message",i.stringify(e));e=this.__socketQueue.shift()}}else{var t=this;setTimeout(function(){t.__socketSend()},100)}};g.prototype.__socketSetup=function(){r&&this.deck.getAttribute("data-sync-server")?this.__socketSetup=function(){m.__socket=new r([i.parse(m.deck.getAttribute("data-sync-insecure"))?"ws":"wss","://",m.deck.getAttribute("data-sync-server"),"/socket/"].join(""));m.__socket.onopen=function(){m.__socketReady=!0;m.__socketSend({type:"ping"})};m.__socket.onerror=function(e){try{n.error("socket error",e)}catch(t){}};m.__socket.onmessage=function(t){m.__debug("received message",t);t=i.parse(t.data);if(t.type==="sync"){m.allowControl===null&&(m.allowControl=e.confirm("Allow the presenter to control your screen?"));m.allowControl&&m.changeToSlide(a(t.hash),t.step,"socket")}else if(t.type==="pong"){v=t.auth;m.inControl=!!v;m.deck.setAttribute("data-in-control",!!v);m.allowControl===null&&(m.allowControl=!0)}};m.__socket.onclose=function(){m.__socketReady=!1;setTimeout(m.__socketSetup,1e3)}}:this.__socketSetup=function(){this.__socket={send:function(){},status:"UNSUPPORTED"}};this.__socketSetup()};g.prototype.__updateTimer=function(){var e=new Date,t;m.__started||(m.__started=e);t=e-m.__started;m.__timer.innerHTML=[Math.floor(t/6e4),l(Math.floor(t/1e3)%60,"0",2)].join(":");setTimeout(function(){m.__updateTimer()},1e3)};g.prototype.__setProgress=function(e){this.__progress.setAttribute("value",e);this.__selector.value=e-1};g.prototype.__emitEvent=function(e,t){t||(t={});t.deck=this;var n=new CustomEvent(e,{detail:t,bubbles:!0});this.__debug("emitting "+e+" event",n);this.deck.dispatchEvent(n)};t.addEventListener("decsschange",function(e){if(v&&e.detail&&e.detail.deck&&e.detail.slide&&e.detail.sender&&e.detail.sender!=="socket"){var t=e.detail.deck;t.__socketSend({hash:e.detail.slide.getAttribute("id"),step:e.detail.step})}},!1);g.prototype.changeToSlide=function(t,n,r){!m.__started&&(r==="keyboard"||r==="touch")&&m.__updateTimer();typeof t=="string"?t=f(m.deck,["#",a(t)].join("")).pop(0):typeof t=="number"&&m.slides.length&&t>=0&&t<m.slides.length&&(t=m.slides[t]);if(t&&m.currentSlide!==t){e.location.href=["#",t.getAttribute("id")].join("");m.__body.setAttribute("data-current-slide",a());m.__body.scrollTop=0;m.__setProgress(m.slides.indexOf(t)+1);f(t,"audio:not([data-step]):not([controls]),video:not([data-step]):not([controls])").forEach(function(e){if(e.play){e.played.length&&(e.src=e.currentSrc);e.play()}});var i=m.currentPosition,s=m.currentSlide;m.currentSlide=t;m.currentPosition=m.slides.indexOf(t);if(Math.abs(m.currentPosition-i)>1)if(m.currentPosition-i>0)while(i<m.currentPosition){s=m.slides[i];f(s,"[data-step]:not(.active)").forEach(function(e){e.classList.add("active")});s.currentStep=s.steps;i+=1}else while(m.currentPosition<i){s=m.slides[i];f(s,"[data-step].active").forEach(function(e){e.classList.remove("active")});s.currentStep=0;i-=1}m.__setProgress(m.currentPosition+1)}if(t&&t===m.currentSlide&&typeof n!="undefined"&&n!==t.currentStep)if(n<t.currentStep)while(t.currentStep>n){f(m.currentSlide,'[data-step="'+m.currentSlide.currentStep+'"]').forEach(function(e){e.classList.remove("active")});m.currentSlide.currentStep-=1;m.currentSlide.setAttribute("data-current-step",m.currentSlide.currentStep)}else if(n>t.currentStep)while(t.currentStep<n){m.currentSlide.currentStep+=1;m.currentSlide.setAttribute("data-current-step",m.currentSlide.currentStep);f(m.currentSlide,'[data-step="'+m.currentSlide.currentStep+'"]').forEach(function(e){e.classList.add("active");if(e.play){e.played.length&&(e.src=e.currentSrc);e.play()}})}m.currentSlide.setAttribute("data-current-step",m.currentSlide.currentStep);m.__emitEvent("decsschange",{slide:m.currentSlide,step:m.currentSlide.currentStep,sender:r});m.currentPosition===m.slides.length-1&&m.currentSlide.currentStep===m.currentSlide.steps&&m.__emitEvent("decssend",{sender:r})};g.prototype.previous=function(e){this.currentSlide.currentStep>=1?this.changeToSlide(this.currentSlide,this.currentSlide.currentStep-1,e):this.currentPosition-1>=0&&this.changeToSlide(this.currentPosition-1,this.slides[this.currentPosition-1].currentStep,e)};g.prototype.next=function(e){this.currentSlide.currentStep<this.currentSlide.steps?this.changeToSlide(this.currentSlide,this.currentSlide.currentStep+1,e):this.currentPosition+1<this.slides.length&&this.changeToSlide(this.currentPosition+1,this.slides[this.currentPosition+1].currentStep,e)};g.prototype.home=function(e){this.changeToSlide(this.slides[0],0,e)};g.prototype.end=function(e){this.changeToSlide(this.slides[this.slides.length-1],0,e)};t.readyState==="complete"?y():t.addEventListener("DOMContentLoaded",y,!1)})(window,document,window.console,window.WebSocket,window.JSON);