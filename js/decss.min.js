/*jshint loopfunc: true */(function(e,t,n,r,i){"use strict";function a(t){t||(t=e.location.hash);return t.replace(/^#/,"")}function f(e,t){try{return Array.prototype.slice.call(e.querySelectorAll(t),0)}catch(n){return[]}}function l(e,t,n){e=String(e);while(e.length<n)e=[t,e].join("");return e}function p(){this.__html=t.getElementsByTagName("html")[0];this.__body=t.body||t.documentElement;this.__progress=t.createElement("progress");this.__timer=t.createElement("time");this.__selector=t.createElement("select");this.__started=null;this.__socket=null;this.__socketReady=!1;this.__socketQueue=[];this.deck=t.getElementById("deck");this.slides=f(this.deck,"section");this.id=this.deck.getAttribute("data-id");this.currentSlide=this.slides[0];this.currentPosition=0;this.touchDuration=Math.max(this.deck.getAttribute("data-touch-duration")?parseFloat(this.deck.getAttribute("data-touch-duration")):0,500);this.touchDistance=Math.max(this.deck.getAttribute("data-touch-distance")?parseFloat(this.deck.getAttribute("data-touch-distance")):0,150);this.fullscreen=!1;this.debug=this.deck.getAttribute("data-debug")?!!i.parse(this.deck.getAttribute("data-debug")):!1;this.inControl=!1;this.allowControl=null}function d(){h=new p;e.Decss=h;h.init()}var s={queryselectorall:t.querySelectorAll,classlist:(t.body||t.documentElement).classList,addeventlistener:e.addEventListener,forEach:Array.prototype.forEach,indexOf:Array.prototype.indexOf,json:i&&i.parse&&i.stringify},o=!0;for(var u in s)if(typeof s[u]=="undefined"){(t.body||t.documentElement).className+=[" ",u,"-not-supported"].join("");o=!1}if(!o){(t.body||t.documentElement).className+=" not-supported";return}var c=!1,h;p.prototype.__debug=function(){this.debug&&n.debug&&n.debug.apply(n,arguments)};p.prototype.init=function(){h.__progress.setAttribute("max",h.slides.length);h.__setProgress(1);h.__body.appendChild(h.__progress);h.__timer.setAttribute("id","timer");h.__timer.innerHTML="0:00";h.__body.appendChild(h.__timer);h.slides.forEach(function(e,t){e.getAttribute("id")||e.setAttribute("id",["slide",t+1].join("-"));var n="0";f(e,"[data-step]").forEach(function(e){n=n<e.getAttribute("data-step")?e.getAttribute("data-step"):n});e.steps=parseFloat(n);e.setAttribute("data-current-step",0);e.setAttribute("data-steps",e.steps.toFixed("0"));e.currentStep=0;e.setAttribute("data-slide",t+1);e.setAttribute("data-total",h.slides.length)});h.__selector.setAttribute("id","selector");var n=t.createElement("option"),r=h.slides.length;while(r--){var i=n.cloneNode();i.setAttribute("value",r);i.innerHTML="Slide "+l(r+1,"0",String(h.slides.length).length)+": "+h.slides[r].getAttribute("id");h.__selector.insertBefore(i,h.__selector.firstChild)}h.__body.appendChild(h.__selector);h.__selector.addEventListener("change",function(e){h.changeToSlide(parseFloat(h.__selector.value))},!1);e.addEventListener("load",function(){f(h.deck,"figure").forEach(function(e){e.maxHeight=0;f(e,"img").forEach(function(t){t.displayHeight=t.getAttribute("height")?parseFloat(t.getAttribute("height")):t.height;e.maxHeight=t.displayHeight>e.maxHeight?t.displayHeight:e.maxHeight});e.style.maxHeight=e.maxHeight+"px"})},!1);h.__socketSetup();if(!e.location.hash){e.location.hash=h.slides.length?h.slides[0].getAttribute("id"):"";h.changeToSlide(h.slides[0],0,"init")}else{var s=!1;h.slides.forEach(function(e){if(e.getAttribute("id")===a()){s=!0;h.changeToSlide(e,0,"init");return}});s||h.home()}e.addEventListener("load",function(){h.__html.classList.add("ready")});t.addEventListener("webkitfullscreenchange",function(e){h.fullscreen=!!t.webkitFullscreenElement},!1);t.addEventListener("mozfullscreenchange",function(e){h.fullscreen=!!t.mozFullScreenElement},!1);t.addEventListener("msfullscreenchange",function(e){h.fullscreen=!!t.msFullscreenElement},!1);t.addEventListener("fullscreenchange",function(e){h.fullscreen=!!t.fullscreenElement},!1);t.addEventListener("keydown",function(e){switch(e.keyCode){case 33:case 37:h.previous("keyboard");break;case 34:case 39:h.next("keyboard");break;case 27:e.ctrlKey&&h.__html.classList.toggle("presenter");break;case 35:h.end("keyboard");break;case 36:h.home("keyboard");break;case 70:h.goFullscreen();break;default:}},!1);if("ontouchstart"in h.__body){var o={x:0,y:0,time:0};h.__body.addEventListener("touchstart",function(e){var t=e.changedTouches[0];o.x=t.pageX;o.y=t.pageY;o.time=(new Date).getTime();e.preventDefault()},!1);h.__body.addEventListener("touchmove",function(e){e.preventDefault()},!1);h.__body.addEventListener("touchend",function(e){var t=e.changedTouches[0],n=(new Date).getTime(),r={x:o.x-t.pageX,y:o.y-t.pageY,time:n-o.time};if(r.time<=h.touchDuration&&Math.abs(r.x)>=Math.abs(r.y))if(r.x>=h.touchDistance){h.next("touch");h.__started||h.__updateTimer()}else if(r.x<=0-h.touchDistance){h.previous("touch");h.__started||h.__updateTimer()}},!1)}h.__emitEvent("decssinit")};p.prototype.goFullscreen=function(){this.__html.webkitRequestFullscreen?this.goFullscreen=function(){this.__html.webkitRequestFullscreen()}:this.__html.msRequestFullscreen?this.goFullscreen=function(){this.__html.msRequestFullscreen()}:this.__html.mozRequestFullscreen?this.goFullscreen=function(){this.__html.mozRequestFullscreen()}:this.__html.requestFullscreen&&(this.goFullscreen=function(){this.deck.requestFullscreen()});this.goFullscreen()};p.prototype.__socketSend=function(e){if(e){e.id=this.id;e.type=e.type?e.type:"sync";this.__socketQueue.push(e)}if(this.__socketReady){e=this.__socketQueue.shift();while(e){this.__socket.send(i.stringify(e));this.__debug("sending message",i.stringify(e));e=this.__socketQueue.shift()}}else{var t=this;setTimeout(function(){t.__socketSend()},100)}};p.prototype.__socketSetup=function(){r&&this.deck.getAttribute("data-sync-server")?this.__socketSetup=function(){h.__socket=new r(["wss://",h.deck.getAttribute("data-sync-server"),"/socket/"].join(""));h.__socket.onopen=function(){h.__socketReady=!0;h.__socketSend({type:"ping"})};h.__socket.onerror=function(e){try{n.error("socket error",e)}catch(t){}};h.__socket.onmessage=function(t){h.__debug("received message",t);t=i.parse(t.data);if(t.type==="sync"){h.allowControl===null&&(h.allowControl=e.confirm("Allow the presenter to control your screen?"));h.allowControl&&h.changeToSlide(a(t.hash),t.step,"socket")}else if(t.type==="pong"){c=t.auth;h.inControl=!!c;h.deck.setAttribute("data-in-control",!!c);h.allowControl===null&&(h.allowControl=!0)}};h.__socket.onclose=function(){h.__socketReady=!1;setTimeout(h.__socketSetup,1e3)}}:this.__socketSetup=function(){this.__socket={send:function(){},status:"UNSUPPORTED"}};this.__socketSetup()};p.prototype.__updateTimer=function(){var e=new Date,t;h.__started||(h.__started=e);t=e-h.__started;h.__timer.innerHTML=[Math.floor(t/6e4),l(Math.floor(t/1e3)%60,"0",2)].join(":");setTimeout(function(){h.__updateTimer()},1e3)};p.prototype.__setProgress=function(e){this.__progress.setAttribute("value",e);this.__selector.value=e-1};p.prototype.__emitEvent=function(e,t){t||(t={});t.deck=this;var n=new CustomEvent(e,{detail:t,bubbles:!0});this.__debug("emitting "+e+" event",n);this.deck.dispatchEvent(n)};t.addEventListener("decsschange",function(e){if(c&&e.detail&&e.detail.deck&&e.detail.slide&&e.detail.sender&&e.detail.sender!=="socket"){var t=e.detail.deck;t.__socketSend({hash:e.detail.slide.getAttribute("id"),step:e.detail.step})}},!1);p.prototype.changeToSlide=function(t,n,r){!h.__started&&(r==="keyboard"||r==="touch")&&h.__updateTimer();typeof t=="string"?t=f(h.deck,["#",a(t)].join("")).pop(0):typeof t=="number"&&h.slides.length&&t>=0&&t<h.slides.length&&(t=h.slides[t]);if(t&&h.currentSlide!==t){e.location.href=["#",t.getAttribute("id")].join("");h.__body.setAttribute("data-current-slide",a());h.__body.scrollTop=0;h.__setProgress(h.slides.indexOf(t)+1);f(t,"audio:not([data-step]):not([controls]),video:not([data-step]):not([controls])").forEach(function(e){if(e.play){e.played.length&&(e.src=e.currentSrc);e.play()}});var i=h.currentPosition,s=h.currentSlide;h.currentSlide=t;h.currentPosition=h.slides.indexOf(t);if(Math.abs(h.currentPosition-i)>1)if(h.currentPosition-i>0)while(i<h.currentPosition){s=h.slides[i];f(s,"[data-step]:not(.active)").forEach(function(e){e.classList.add("active")});s.currentStep=s.steps;i+=1}else while(h.currentPosition<i){s=h.slides[i];f(s,"[data-step].active").forEach(function(e){e.classList.remove("active")});s.currentStep=0;i-=1}h.__setProgress(h.currentPosition+1)}if(t&&t===h.currentSlide&&typeof n!="undefined"&&n!==t.currentStep)if(n<t.currentStep)while(t.currentStep>n){f(h.currentSlide,'[data-step="'+h.currentSlide.currentStep+'"]').forEach(function(e){e.classList.remove("active")});h.currentSlide.currentStep-=1;h.currentSlide.setAttribute("data-current-step",h.currentSlide.currentStep)}else if(n>t.currentStep)while(t.currentStep<n){h.currentSlide.currentStep+=1;h.currentSlide.setAttribute("data-current-step",h.currentSlide.currentStep);f(h.currentSlide,'[data-step="'+h.currentSlide.currentStep+'"]').forEach(function(e){e.classList.add("active");if(e.play){e.played.length&&(e.src=e.currentSrc);e.play()}})}h.currentSlide.setAttribute("data-current-step",h.currentSlide.currentStep);h.__emitEvent("decsschange",{slide:h.currentSlide,step:h.currentSlide.currentStep,sender:r});h.currentPosition===h.slides.length-1&&h.currentSlide.currentStep===h.currentSlide.steps&&h.__emitEvent("decssend",{sender:r})};p.prototype.previous=function(e){this.currentSlide.currentStep>=1?this.changeToSlide(this.currentSlide,this.currentSlide.currentStep-1,e):this.currentPosition-1>=0&&this.changeToSlide(this.currentPosition-1,this.slides[this.currentPosition-1].currentStep,e)};p.prototype.next=function(e){this.currentSlide.currentStep<this.currentSlide.steps?this.changeToSlide(this.currentSlide,this.currentSlide.currentStep+1,e):this.currentPosition+1<this.slides.length&&this.changeToSlide(this.currentPosition+1,this.slides[this.currentPosition+1].currentStep,e)};p.prototype.home=function(e){this.changeToSlide(this.slides[0],0,e)};p.prototype.end=function(e){this.changeToSlide(this.slides[this.slides.length-1],0,e)};t.readyState==="complete"?d():t.addEventListener("DOMContentLoaded",d,!1)})(window,document,window.console,window.WebSocket,window.JSON);